---
- name: "clone project"
  git:
    repo: "{{ project_repo }}"
    version: "{{ git_ref }}"
    dest: "{{ project_path }}"
    accept_hostkey: True
  remote_user: "{{ deployer }}"


- name: "install tool versions"
  command: "/home/{{ deployer }}/.asdf/bin/asdf install"
  remote_user: "{{ deployer }}"
  args:
    chdir: "{{ project_path }}"


- name: "fetch mix dependencies"
  command: 'bash -lc "mix deps.get"'
  remote_user: "{{ deployer }}"
  args:
    chdir: "{{ project_path }}"
  environment:
    MIX_ENV: "{{ mix_env }}"
